<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GSODR use case: Finding specific stations using spatial queries • GSODR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="GSODR use case: Finding specific stations using spatial queries">
<meta property="og:description" content="">
<meta property="og:image" content="https://ropensci.github.io/GSODR/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GSODR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.2.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/GSODR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Working_with_spatial_and_climate_data.html">Working with spatial and climate data from GSODR and GSODRdata</a>
    </li>
    <li>
      <a href="../articles/use_case_1.html">GSODR use case: Finding specific stations using spatial queries</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/GSODR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>GSODR use case: Finding specific stations using spatial queries</h1>
                        <h4 class="author">Adam H Sparks</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/GSODR/blob/master/vignettes/use_case_1.Rmd"><code>vignettes/use_case_1.Rmd</code></a></small>
      <div class="hidden name"><code>use_case_1.Rmd</code></div>

    </div>

    
    
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The <a href="http://irri.org/">IRRI (International Rice Research Institute)</a> survey loop in Central Luzon is a study that aims to monitor the changes in rice farming in the major rice producing area of the Philippines - the Central Luzon region, which is called as the “rice bowl of the Philippines”. Data have been collected in this project since the 1960s. See, <a href="http://ricestat.irri.org/fhsd/php/panel.php?page=1&amp;sortBy=title&amp;sortOrder=ascending#" class="uri">http://ricestat.irri.org/fhsd/php/panel.php?page=1&amp;sortBy=title&amp;sortOrder=ascending#</a> for the panel data.</p>
<p>This vignette details how to find and retrieve weather data for the area that this survey covers for the time period of 1960-2016. Methods that are detailed include:</p>
<ul>
<li><p>retrieving a spatial object of provincial level data;</p></li>
<li><p>sub-setting this data for the provinces of interest;</p></li>
<li><p>finding stations that fall within this polygon;</p></li>
<li><p>determining which stations provide data for the specified time-period, 1960-2015; and</p></li>
<li><p>downloading the station files and creating a single CSV file of the data for analysis.</p></li>
</ul>
</div>
<div id="retrieve-phl-provincial-map-and-select-loop-provinces" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieve-phl-provincial-map-and-select-loop-provinces" class="anchor"></a>Retrieve PHL provincial map and select loop provinces</h2>
<p>As a first step, we’ll use the <a href="https://cran.r-project.org/package=raster"><em>raster</em></a> package to retrieve data from <a href="https://gadm.org/data.html">GADM</a> that will provide the provincial spatial data for the survey area. We will then use this to find the stations that fall within the provinces where the study was conducted.</p>
<p>Using <code><a href="http://www.rdocumentation.org/packages/raster/topics/getData">raster::getData()</a></code> fetch level 0 (national) and 1 (provincial) data for the Philippines.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">RP0 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getData">getData</a></span>(<span class="dt">country =</span> <span class="st">"Philippines"</span>, <span class="dt">level =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">RP1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getData">getData</a></span>(<span class="dt">country =</span> <span class="st">"Philippines"</span>, <span class="dt">level =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Now we will select the provinces involved in the survey and make a new object called <code>Central_Luzon</code> from the provincial level data, <code>RP1</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">Central_Luzon &lt;-<span class="st"> </span>RP1[RP1<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span> <span class="op">==</span><span class="st"> "Pampanga"</span> <span class="op">|</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">                     </span>RP1<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span> <span class="op">==</span><span class="st"> "Tarlac"</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">                     </span>RP1<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span> <span class="op">==</span><span class="st"> "Pangasinan"</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">                     </span>RP1<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span> <span class="op">==</span><span class="st"> "La Union"</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">                     </span>RP1<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span> <span class="op">==</span><span class="st"> "Nueva Ecija"</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">                     </span>RP1<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span> <span class="op">==</span><span class="st"> "Bulacan"</span>, ]</a></code></pre></div>
<p>Next, create a map inset showing where the Central Luzon Loop survey takes place.</p>
<p>First we’ll use <code><a href="http://www.rdocumentation.org/packages/rgeos/topics/topo-unary-gSimplify">gSimplify()</a></code> from <em>rgeos</em> to simplify the map of the Philippines to make the map generation in the next few steps much quicker.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(rgeos)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">RP0 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/rgeos/topics/topo-unary-gSimplify">gSimplify</a></span>(RP0, <span class="dt">tol =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(grid)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># get center coordinates of provinces in Central Luzon</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">CL_names &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(Central_Luzon))</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co"># this is then used to label the procinces on the map</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">CL_names<span class="op">$</span>label &lt;-<span class="st"> </span>Central_Luzon<span class="op">@</span>data<span class="op">$</span>NAME_<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co"># Main map</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_polygon">geom_polygon</a></span>(<span class="dt">data =</span> Central_Luzon,</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">               <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> long,</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">                   <span class="dt">y =</span> lat,</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">                   <span class="dt">group =</span> group),</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">               <span class="dt">colour =</span> <span class="st">"grey10"</span>,</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">               <span class="dt">fill =</span> <span class="st">"#fff7bc"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_text">geom_text</a></span>(<span class="dt">data =</span> CL_names, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> X1,</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">                                 <span class="dt">y =</span> X2, </a>
<a class="sourceLine" id="cb4-22" data-line-number="22">                                 <span class="dt">label =</span> label), </a>
<a class="sourceLine" id="cb4-23" data-line-number="23">            <span class="dt">size =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">            <span class="dt">colour =</span> <span class="st">"grey20"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.text.y =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_text</a></span>(<span class="dt">angle =</span> <span class="dv">90</span>,</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">                                   <span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Central Luzon Provinces Surveyed"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Longitude"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Latitude"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_map">coord_map</a></span>()</a>
<a class="sourceLine" id="cb4-32" data-line-number="32"></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co"># Inset map</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34">p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_polygon">geom_polygon</a></span>(<span class="dt">data =</span> RP0, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(long, lat, <span class="dt">group =</span> group),</a>
<a class="sourceLine" id="cb4-36" data-line-number="36">               <span class="dt">colour =</span> <span class="st">"grey10"</span>,</a>
<a class="sourceLine" id="cb4-37" data-line-number="37">               <span class="dt">fill =</span> <span class="st">"#fff7bc"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_fixed">coord_equal</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_tile">geom_rect</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">xmin =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(Central_Luzon)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb4-42" data-line-number="42">                <span class="dt">xmax =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(Central_Luzon)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb4-43" data-line-number="43">                <span class="dt">ymin =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(Central_Luzon)[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb4-44" data-line-number="44">                <span class="dt">ymax =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(Central_Luzon)[<span class="dv">4</span>]),</a>
<a class="sourceLine" id="cb4-45" data-line-number="45">            <span class="dt">alpha =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb4-46" data-line-number="46">            <span class="dt">colour =</span> <span class="st">"red"</span>,</a>
<a class="sourceLine" id="cb4-47" data-line-number="47">            <span class="dt">size =</span> <span class="fl">0.7</span>,</a>
<a class="sourceLine" id="cb4-48" data-line-number="48">            <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.text.x =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),</a>
<a class="sourceLine" id="cb4-50" data-line-number="50">        <span class="dt">axis.text.y =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),</a>
<a class="sourceLine" id="cb4-51" data-line-number="51">        <span class="dt">axis.ticks =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),</a>
<a class="sourceLine" id="cb4-52" data-line-number="52">        <span class="dt">axis.title.x =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),</a>
<a class="sourceLine" id="cb4-53" data-line-number="53">        <span class="dt">axis.title.y =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),</a>
<a class="sourceLine" id="cb4-54" data-line-number="54">        <span class="dt">plot.margin =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/reexports">unit</a></span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span> ,<span class="dv">0</span>), <span class="st">"mm"</span>))</a>
<a class="sourceLine" id="cb4-55" data-line-number="55"></a>
<a class="sourceLine" id="cb4-56" data-line-number="56"><span class="kw"><a href="http://www.rdocumentation.org/packages/grid/topics/grid.newpage">grid.newpage</a></span>()</a>
<a class="sourceLine" id="cb4-57" data-line-number="57"><span class="co"># plot area for the main map</span></a>
<a class="sourceLine" id="cb4-58" data-line-number="58">v1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/grid/topics/viewport">viewport</a></span>(<span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">height =</span> <span class="dv">1</span>, <span class="dt">x =</span> <span class="fl">0.5</span>, <span class="dt">y =</span> <span class="fl">0.5</span>) </a>
<a class="sourceLine" id="cb4-59" data-line-number="59"></a>
<a class="sourceLine" id="cb4-60" data-line-number="60"><span class="co"># plot area for the inset map</span></a>
<a class="sourceLine" id="cb4-61" data-line-number="61">v2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/grid/topics/viewport">viewport</a></span>(<span class="dt">width =</span> <span class="fl">0.28</span>, <span class="dt">height =</span> <span class="fl">0.28</span>, <span class="dt">x =</span> <span class="fl">0.67</span>, <span class="dt">y =</span> <span class="fl">0.79</span>)</a>
<a class="sourceLine" id="cb4-62" data-line-number="62"></a>
<a class="sourceLine" id="cb4-63" data-line-number="63"><span class="co"># print the map object</span></a>
<a class="sourceLine" id="cb4-64" data-line-number="64"><span class="kw">print</span>(p1, <span class="dt">vp =</span> v1) </a>
<a class="sourceLine" id="cb4-65" data-line-number="65"><span class="kw">print</span>(p2, <span class="dt">vp =</span> v2)</a></code></pre></div>
<div class="figure">
<img src="../man/figures/Use_Case_1_Figure_1.png" alt="Figure 1: Station locations"><p class="caption">Figure 1: Station locations</p>
</div>
</div>
<div id="identify-stations-in-area-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-stations-in-area-of-interest" class="anchor"></a>Identify stations in area of interest</h2>
<p>Next, make a list of stations that are within this area. <em>GSODR</em> provides a table of the metadata associated with GSOD stations, which includes latitude and longitude that can be used to identify stations falling within the area of interest.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(GSODR)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># load the station metadata file from GSODR (this loads `isd_history` in your</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># R sesion)</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">load</span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"isd_history.rda"</span>, <span class="dt">package =</span> <span class="st">"GSODR"</span>))</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">isd_history &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/as.data.frame">as.data.frame</a></span>(isd_history)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co"># convert to a spatial object to find stations within the states</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(isd_history) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>LON <span class="op">+</span><span class="st"> </span>LAT</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(isd_history) &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(Central_Luzon)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co"># what are the coordinates? We use the row numbers from this to match the</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co"># `stations` data.frame</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">station_coords &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(isd_history[Central_Luzon, ])</a>
<a class="sourceLine" id="cb5-16" data-line-number="16"></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co"># get row numbers as an object</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">rows &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">row.names</span>(station_coords))</a>
<a class="sourceLine" id="cb5-19" data-line-number="19"></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co"># create a data frame of only the stations which rows have been identified</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21">loop_stations &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/as.data.frame">as.data.frame</a></span>(isd_history)[rows, ]</a>
<a class="sourceLine" id="cb5-22" data-line-number="22"></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co"># subset stations that match our criteria for years</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24">loop_stations &lt;-<span class="st"> </span>loop_stations[loop_stations<span class="op">$</span>BEGIN <span class="op">&lt;=</span><span class="st"> </span><span class="dv">19600101</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="st">                               </span>loop_stations<span class="op">$</span>END <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20151231</span>, ]</a>
<a class="sourceLine" id="cb5-26" data-line-number="26"></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="kw">print</span>(loop_stations[, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>)])</a></code></pre></div>
<pre><code>        USAF  WBAN   STN_NAME    LAT    LON ELEV_M    BEGIN      END        STNID
25617 983250 99999    DAGUPAN 16.083 120.35    2.0 19450119 20180610 983250-99999
25619 983270 99999 CLARK INTL 15.186 120.56  147.5 19450214 20180610 983270-99999
25623 983300 99999 CABANATUAN 15.467 120.95   32.0 19490101 20180610 983300-99999</code></pre>
<p>These are all of the stations that are available within the provinces of interest and the locations in the provinces.</p>
<div id="map-station-locations" class="section level3">
<h3 class="hasAnchor">
<a href="#map-station-locations" class="anchor"></a>Map station locations</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">p1 <span class="op">+</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> loop_stations,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> LON,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                 <span class="dt">y =</span> LAT),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">             <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_text">geom_text</a></span>(<span class="dt">data =</span> loop_stations,</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">            <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> LON,</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">                <span class="dt">y =</span> LAT,</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">                <span class="dt">label =</span> STN_NAME),</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">            <span class="dt">alpha =</span> <span class="fl">0.6</span>,</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">            <span class="dt">size =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">            <span class="dt">position =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/position_nudge">position_nudge</a></span>(<span class="fl">0.1</span>, <span class="fl">-0.05</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Station locations"</span>)</a></code></pre></div>
</div>
</div>
<div id="import-the-weather-data-into-r" class="section level2">
<h2 class="hasAnchor">
<a href="#import-the-weather-data-into-r" class="anchor"></a>Import the weather data into R</h2>
<div id="use-get_gsod-to-fetch-the-requested-station-files" class="section level3">
<h3 class="hasAnchor">
<a href="#use-get_gsod-to-fetch-the-requested-station-files" class="anchor"></a>Use <code><a href="../reference/get_GSOD.html">get_GSOD()</a></code> to fetch the requested station files</h3>
<p>This example shows how you could construct a query using the <code><a href="../reference/get_GSOD.html">get_GSOD()</a></code> function. Be aware that it may result in incomplete data and error from the server if it stops responding. We’ve done our best to make <em>GSODR</em> handle these errors, but if it does this, see the following option for using the <code><a href="../reference/reformat_GSOD.html">reformat_GSOD()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">PHL &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_GSOD.html">get_GSOD</a></span>(<span class="dt">station =</span> loop_stations[, <span class="dv">12</span>], <span class="dt">years =</span> <span class="dv">1960</span><span class="op">:</span><span class="dv">2015</span>)</a></code></pre></div>
</div>
<div id="another-option-use-reformat_gsod" class="section level3">
<h3 class="hasAnchor">
<a href="#another-option-use-reformat_gsod" class="anchor"></a>Another option, use <code><a href="../reference/reformat_GSOD.html">reformat_GSOD()</a></code>
</h3>
<p><em>GSODR</em> provides a function for dealing with local files that have been transferred from the server already as well, <code><a href="../reference/reformat_GSOD.html">reformat_GSOD()</a></code>. If the previous example with <code><a href="../reference/get_GSOD.html">get_GSOD()</a></code> does not work, this is a good alternative that takes a bit more intervention but gives the same results.</p>
<p>Using your FTP client (<em>e.g.</em>, FileZilla) log into the NCEI FTP server, <a href="ftp.ncdc.noaa.gov">&lt;ftp.ncdc.noaa.gov&gt;</a> and navigate to /pub/data/gsod/. Manually downloading the files for each station listed above from 1960 to 2015 is possible, but tedious. An easier solution is to simply download the annual files found in each yearly directory, “gsod-YYYY.tar” and untar them locally and then use R to list the available files and select only the files for the stations of interest. Lastly, write the data to disk as a CSV file for saving and later use.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">years &lt;-<span class="st"> </span><span class="dv">1960</span><span class="op">:</span><span class="dv">2015</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">loop_stations &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> loop_stations[, <span class="dv">12</span>]))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co"># create file list</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">loop_stations &lt;-<span class="st"> </span><span class="kw">do.call</span>(</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  paste0, <span class="kw">c</span>(<span class="kw">expand.grid</span>(loop_stations, <span class="st">"-"</span>, years, <span class="st">".op.gz"</span>))</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">local_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">path =</span> <span class="st">"./GSOD"</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">local_files &lt;-<span class="st"> </span>local_files[<span class="kw">basename</span>(local_files) <span class="op">%in%</span><span class="st"> </span>loop_stations]</a>
<a class="sourceLine" id="cb9-12" data-line-number="12"></a>
<a class="sourceLine" id="cb9-13" data-line-number="13">loop_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/reformat_GSOD.html">reformat_GSOD</a></span>(<span class="dt">file_list =</span> local_files)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14"></a>
<a class="sourceLine" id="cb9-15" data-line-number="15">readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/write_delim">write_csv</a></span>(loop_data, <span class="dt">path =</span> <span class="st">"Loop_Survey_Weather_1960-2015"</span>, <span class="dt">path =</span> <span class="st">"./"</span>)</a></code></pre></div>
<div class="figure">
<img src="../man/figures/Use_Case_1_Figure_2.png" alt="Figure 2: Station locations"><p class="caption">Figure 2: Station locations</p>
</div>
</div>
</div>
<div id="notes" class="section level1">
<h1 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h1>
<div id="sources" class="section level2">
<h2 class="hasAnchor">
<a href="#sources" class="anchor"></a>Sources</h2>
<div id="elevation-values" class="section level4">
<h4 class="hasAnchor">
<a href="#elevation-values" class="anchor"></a>Elevation values</h4>
<p>90m hole-filled SRTM digital elevation (Jarvis <em>et al.</em> 2008) was used t o identify and correct/remove elevation errors in data for station locations between -60˚ and 60˚ latitude. This applies to cases here where elevation was missing in the reported values as well. In case the station reported an elevation and the DEM does not, the station reported is taken. For stations beyond -60˚ and 60˚ latitude, the values are station reported values in every instance. See <a href="https://github.com/ropensci/GSODR/blob/master/data-raw/fetch_isd-history.html" class="uri">https://github.com/ropensci/GSODR/blob/master/data-raw/fetch_isd-history.md</a> for more detail on the correction methods.</p>
</div>
</div>
<div id="wmo-resolution-40--noaa-policy" class="section level2">
<h2 class="hasAnchor">
<a href="#wmo-resolution-40--noaa-policy" class="anchor"></a>WMO Resolution 40. NOAA Policy</h2>
<p><em>Users of these data should take into account the following (from the <a href="http://www7.ncdc.noaa.gov/CDO/cdoselect.cmd?datasetabbv=GSOD&amp;countryabbv=&amp;georegionabbv=">NCEI website</a>):</em></p>
<blockquote>
<p>“The following data and products may have conditions placed on their international commercial use. They can be used within the U.S. or for non-commercial international activities without restriction. The non-U.S. data cannot be redistributed for commercial purposes. Re-distribution of these data by others must provide this same notification.” <a href="https://public.wmo.int/en/our-mandate/what-we-do/data-exchange-and-technology-transfer">WMO Resolution 40. NOAA Policy</a></p>
</blockquote>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Jarvis, A., Reuter, H.I., Nelson, A., Guevara, E. (2008) Hole-filled SRTM for the globe Version 4, available from the CGIAR-CSI SRTM 90m Database (<a href="http://srtm.csi.cgiar.org" class="uri">http://srtm.csi.cgiar.org</a>)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose">Purpose</a></li>
      <li><a href="#retrieve-phl-provincial-map-and-select-loop-provinces">Retrieve PHL provincial map and select loop provinces</a></li>
      <li><a href="#identify-stations-in-area-of-interest">Identify stations in area of interest</a></li>
      <li><a href="#import-the-weather-data-into-r">Import the weather data into R</a></li>
      <li>
<a href="#notes">Notes</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sources">Sources</a></li>
      <li><a href="#wmo-resolution-40--noaa-policy">WMO Resolution 40. NOAA Policy</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adam Sparks, Tomislav Hengl, Andrew Nelson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    
    apiKey: '432336b5561cc8eeddda9af96c7a8cc2',
    indexName: 'gsodr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
